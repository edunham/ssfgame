<head>

</head>

<body>
    <style>
        .wrapper {
            display: flex;
            flex-direction: row;
        }

        .wrapper>div {
            font-size: 4vh;
            color: white;
            background: lightslategrey;
            margin: .1em;
            padding: .3em;
            border-radius: 3px;
            flex: 1;
            flex-direction: row;
        }

        .wrapper .wrapper>div {
            background: lightgray;
            color: blue;
            flex-direction: row;

        }
    </style>
    <div class="wrapper">

        <div id="clock">day 0</div>
        <div id="wallet">$0</div>
    </div>
    <div class="wrapper">
        <div>Tools
            <div id="current-tool">no tool selected</div>
            <div class="wrapper" id="tools">
                <div><button id='research'>Research</button></div>
                <div><button id='phish'>Phish</button></div>
                <div>3</div>
            </div>
        </div>
        <div>Places
            <div class="wrapper" id="places">
            </div>
        </div>
    </div>
    <div class="wrapper">
        <div class="wrapper" id="accounts">Accounts</div>
        <div class="wrapper" id="events">Events</div>
        
    </div>


    <!-- -->
    <script>
        var cash = 0;
        const starters = [5, 10, 15, 20, 25, 30, 35, 40];
        const faces = ["👦", "👧", "👨", "👩", "👴", "👵", "😀", "😁", "😂", "😃", "😄", "😅", "😆", "😎", "😇", "😏", "😐", "😉", "😊", "😑", "😒", "😋", "😌", "😓", "😔", "😍", "😕", "😜", "😝", "😖", "😗",
            "😞", "😟", "😘", "😙", "😠", "😡", "😚", "😛", "😢", "😪", "😣", "😤", "😫", "😥", "😬", "😦", "😭", "😧", "😮", "😯", "😩", "😨", "😲", "😳", "😴", "😵", "😶", "😷", "🙁", "🙂", "🙃", "🙄", "🤐",
            "🤑", "🤒", "🤓", "🤔", "🤤", "🤕", "🤥", "🤗", "🤠", "🤡", "🤧", "🤣", "🥸", "🤩", "😵‍💫", "🤫", "🤭", "🧐", "🤨", "😮‍💨", "😶‍🌫️"];

        const places = ["🏦", "🏨", "🏫", "🏠", "🏛️", "🏬", "🏭", "🏥", "🏣", "🏗️", "🏢", "🏘️"];
        const prices = [0, 0, .01, .01, .1, .1, 1, 1, 1, 10, 100];

        function pickone(items) {
            //get a random one of several things
            return items[Math.floor(Math.random() * items.length)];
        }

        function Business(icon) {
            this.face = icon;
            this.coffers = 0;
            this.caution = 0.25;
            this.cost = pickone(prices);
        }

        function Person() {
            this.face = pickone(faces);
            this.routine = [pickone(places), pickone(places), pickone(places), pickone(places)];
            this.caution = 0.5;
            this.salary = pickone(starters);
            this.wallet = pickone(starters);
        }

        /*
_ __ ___   _____   _____ 
| '_ ` _ \ / _ \ \ / / _ \
| | | | | | (_) \ V /  __/
|_| |_| |_|\___/ \_/ \___|
                          

        */
        function move(who, to) {
            const whence = document.getElementById(who['face']);
            whence.remove();
            var where = document.getElementById(to);
            where.appendChild(whence);
            //todo: move some $$ from the wallet of 'who' into the coffers of 'to', here
            //todo: and if they can't afford this business's cost, they sub in a random different business for this time in their routine

        }



        var schedule = ['🌅', '🏙️', '🌇', '🌃'];

        var days = 0
        var now = 0
        people = []
        businesses = {}

        // initial people setup, places display/setup,and places display
        for (let step = 0; step < 15; step++) {
            people.push(new Person())
        }
        for (p in places) {
            var parent = document.getElementById("places");
            var child = document.createElement("div");
            child.id = places[p];
            child.textContent = places[p];
            parent.appendChild(child);
            businesses[p] = new Business(places[p]);
        }

        for (p in people) {
            var parent = document.getElementById(people[p]['routine'][0]);
            var child = document.createElement("div");
            child.id = people[p]['face'];
            child.textContent = people[p]['face'];
            parent.appendChild(child)
        };

        // phishing tool
        document.getElementById('phish').addEventListener('click', function () {
            console.log("you clicked the phisher");
            document.getElementById("current-tool")
                .innerHTML = "Phishing...";

            for (p in people) {
                //it does go through the add loop on 14 distinct p...
                console.log("adding event listener for " + p + people[p]['face']);
                //TODO FIXME this is adding the same event listener for everyone???
                //and everyone's event listener shows p=14 
                document.getElementById(people[p]['face']).addEventListener('click', function (e) {
                    //tried to phish them
                    //TODO how do i freeze the values from when the event listener was added
                    //maybe by making thefunction not anonymous? resume at https://stackoverflow.com/questions/50816162/addeventlistener-with-named-function-and-parameters
                    console.log(e + " you tried to phish " + people[p]['face']);
                    var roll = Math.random()
                    if (roll > people[p]['caution']) {
                        //successfully phished -- CHANGE THIS to add account to the compromised section
                        console.log("phishing successful!");
                        if (people[p]['wallet'] > 10) {
                            console.log("money acquired");
                            people[p]['wallet'] -= 10;
                            cash += 10;
                        }
                        //business they're in gets .1 more cautious when a successful phish happens there
                    }
                    else {
                        //person gets more cautious when a phish fails
                        people[p]['caution'] += 0.1 * roll;
                        //business they're in gets a teensy bit (.01) more cautious when it fails too?

                        //also update the wallet
                        document.getElementById("wallet")
                            .innerHTML = "$" + cash;
                    }
                })
            }
        })

        //researching tool
        document.getElementById('research').addEventListener('click', function () {
            console.log("you clicked the researcher");
            document.getElementById("current-tool")
                .innerHTML = "Researching...";

            for (p in people) {
                document.getElementById(people[p]['face']).addEventListener('click', function () {
                    //tried to phish them
                    console.log("you tried to research " + people[p]['face']);
                    if (Math.random() > people[p]['caution']) {
                        //successfully researched them
                        console.log("researching successful!");
                        const whom = document.getElementById(people[p]['face']);
                        //tooltip stuff is busted, make research do something else instead... show routine? 
                        // whom.innerHTML = people[p]['face'] + "<span class='tooltip'>Day " + days + ": 💰$" + people[p]['wallet'] + ", 💼$" + people[p]['salary'] + ", 📅: " + people[p]['routine'] + "</span>";

                        //whom.addEventListener("mouseover", showTooltip);
                        //whom.addEventListener("mouseout", hideTooltip);
                    }
                })
            }
        })



        //timer and all that happens on it
        setInterval(function () {
            now += 1;
            if (now > 3) {
                now = 0;
                days += 1;
                for (p in people) {
                    //payday once per day
                    people[p]['wallet'] += people[p]['salary']
                    //also drop their suspicion a bit, function of where they're located
                    people[p]['caution'] -= .005 * people[p]['caution']
                    //also change bank passwords if suspicion high enough (over 90?)
                    //so remove accounts from account list
                }
            }
            time = schedule[now];
            document.getElementById("clock")
                .innerHTML = "day " + days + " " + time;
            document.getElementById("wallet")
                .innerHTML = "$" + cash;
//this is where UL goes, wipe accounts from list
            for (p in people) {
                //console.log(people[p]);
                move(people[p], people[p]['routine'][now]);

            }

            //todo: here, go thru all businesses and if their suspicion is too high they hold a security training
            // if their suspicion is low maybe they get some money from taking out a loan or something
            //if their suspicion is high maybe they spend some money on security
            // if they hold a security training, the business supsicion goes down, the individual suspicions go up, and people maybe replace the business in their routine
        }, 6000);


    </script>

</body>