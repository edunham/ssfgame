<head>

</head>

<body>
    <style>
        .wrapper {
            display: flex;
            flex-direction: row;
        }

        .wrapper>div {
            font-size: 4vh;
            color: white;
            background: lightslategrey;
            margin: .1em;
            padding: .3em;
            border-radius: 3px;
            flex: 1;
            flex-direction: column;
        }

        .wrapper .wrapper>div {
            background: lightgray;
            color: blue;
            flex-direction: row;

        }
    </style>
    <div class="wrapper">

        <div id="clock">day 0</div>
        <div id="wallet">$0</div>
    </div>
    <div class="wrapper">
        <div>Tools
            <div id="current-tool">no tool selected</div>
            <div class="wrapper" id="tools">
                <div><button id='research'>Research</button></div>
                <div><button id='phish'>Phish</button></div>
                <div>3</div>
            </div>
        </div>
        <div>Places
            <div class="wrapper" id="places">
            </div>
        </div>
    </div>
    <div class="wrapper">
        <div class="wrapper">Accounts<div id="accounts"></div>
        </div>
        <div class="wrapper">Events <div id="events"></div>
        </div>

    </div>


    <!-- -->
    <script>
        var cash = 0;
        const starters = [5, 10, 15, 20, 25, 30, 35, 40];
        const faces = ["👦", "👧", "👨", "👩", "👴", "👵", "😀", "😁", "😂", "😃", "😄", "😅", "😆", "😎", "😇", "😏", "😐", "😉", "😊", "😑", "😒", "😋", "😌", "😓", "😔", "😍", "😕", "😜", "😝", "😖", "😗",
            "😞", "😟", "😘", "😙", "😠", "😡", "😚", "😛", "😢", "😪", "😣", "😤", "😫", "😥", "😬", "😦", "😭", "😧", "😮", "😯", "😩", "😨", "😲", "😳", "😴", "😵", "😶", "😷", "🙁", "🙂", "🙃", "🙄", "🤐",
            "🤑", "🤒", "🤓", "🤔", "🤤", "🤕", "🤥", "🤗", "🤠", "🤡", "🤧", "🤣", "🥸", "🤩", "😵‍💫", "🤫", "🤭", "🧐", "🤨", "😮‍💨", "😶‍🌫️"];

        const places = ["🏦", "🏨", "🏫", "🏠", "🏛️", "🏬", "🏭", "🏥", "🏣", "🏗️", "🏢", "🏘️"];
        const prices = [0, 0, .01, .01, .1, .1, 1, 1, 1, 10, 100];

        function pickone(items) {
            //get a random one of several things
            return items[Math.floor(Math.random() * items.length)];
        }

        function Business(icon) {
            this.face = icon;
            this.coffers = 0;
            this.caution = 0.25;
            this.cost = pickone(prices);
        }

        function Person() {
            this.face = pickone(faces);
            this.routine = [pickone(places), pickone(places), pickone(places), pickone(places)];
            this.caution = 0.5;
            this.salary = pickone(starters);
            this.wallet = pickone(starters);
        }

        /*
_ __ ___   _____   _____ 
| '_ ` _ \ / _ \ \ / / _ \
| | | | | | (_) \ V /  __/
|_| |_| |_|\___/ \_/ \___|
                          

        */
        function move(who, to) {
            const whence = document.getElementById(who['face']);
            whence.remove();
            var where = document.getElementById(to);
            where.appendChild(whence);
            //todo: move some $$ from the wallet of 'who' into the coffers of 'to', here
            //todo: and if they can't afford this business's cost, they sub in a random different business for this time in their routine

        }



        var schedule = ['🌅', '🏙️', '🌇', '🌃'];

        var days = 0;
        var now = 0;
        people = [];
        businesses = {};
        action = "";

        // initial people setup, places display/setup,and places display
        for (let step = 0; step < 15; step++) {
            people.push(new Person())
        }
        for (p in places) {
            var parent = document.getElementById("places");
            var child = document.createElement("div");
            child.id = places[p];
            child.textContent = places[p];
            parent.appendChild(child);
            businesses[places[p]] = new Business(places[p]);
        }

        for (p in people) {
            var parent = document.getElementById(people[p]['routine'][0]);
            var child = document.createElement("div");
            child.id = people[p]['face'];
            child.textContent = people[p]['face'];
            parent.appendChild(child)
        };
        function happen(what) {
            const events = document.getElementById("events");
            var child = document.createElement("div");
            child.id = days + schedule[now].charCodeAt(0) + people[p]['face'].charCodeAt(0); // unique-enough event...
            const stamp = "day " + days + ": ";
            child.textContent = stamp + what;
            if (events.firstChild) {
                //thank you claude for firstchild logic
                events.insertBefore(child, events.firstChild);
            } else {
                events.appendChild(child);
            }
        }

        compromised = [] // these are the p ids for the people so people[p] gets their details
        function loseAccount(a) {
            compromised.splice(compromised.indexOf(a), 1);
        }

        function updateAccounts() {
            console.log(compromised)
            const accounts = document.getElementById("accounts");
            //remove all children of the accounts div
            accounts.innerHTML = "";
            for (let a of Object.keys(compromised)) {
                //re-add accounts one by one
                var child = document.createElement("div");
                i = people[a]['face'].charCodeAt(0);
                child.id = i; // unique-enough event...
                var empty = document.createElement("button");
                var escalate = document.createElement("button");
                const biz = people[a]['routine'][now];

                empty.id = "empty" + i;
                empty.textContent = "💸";
                escalate.id = "empty" + biz.charCodeAt(0);
                escalate.textContent = biz;
                empty.addEventListener('click', function (e) {
                    //clicked to take their money
                    take = people[a]['wallet'];
                    people[a]['wallet'] = 0;
                    cash += take
                    happen(people[a]['face'] + " had $" + take + " stolen")
                    people[a]['caution'] = 0.9;
                    console.log(biz)
                    console.log(businesses)
                    businesses[biz]['caution'] += people[a]['salary'] / 2;
                    updateAccounts()
                })
                escalate.addEventListener('click', function (e) {



                })
                child.textContent = people[a]['face'] + " " + i + ": $" + people[a]['wallet'];
                child.appendChild(empty);
                child.appendChild(escalate);
                if (accounts.firstChild) {
                    //thank you claude for firstchild logic
                    accounts.insertBefore(child, accounts.firstChild);
                } else {
                    accounts.appendChild(child);
                }
            }

        }
        /**
         * ALL PEOPLE RESPONSES TO GETTING CLICKED GO HERE
         */
        for (let p of Object.keys(people)) {
            // this "let p of Object.keys" thing came from Claude when we had a chat about js internals
            console.log("adding event listener for " + p + people[p]['face']);
            document.getElementById(people[p]['face']).addEventListener('click', function (e) {
                var roll = Math.random();
                if (action == "phish") {
                    if (roll > people[p]['caution']) {
                        //successful phish
                        happen("phished" + people[p]['face'])
                        console.log("unshifting " + p)
                        compromised.unshift(p)
                        updateAccounts()
                        businesses[people[p]['routine'][now]]['caution'] += .25 * people[p]['salary']

                        //business they're in gets .1 more cautious when a successful phish happens there
                    }
                    else {
                        //person gets more cautious when a phish fails
                        people[p]['caution'] += 0.1 * roll;
                        happen(people[p]['face'] + "was too cautious to phish!")
                        //business they're in gets a teensy bit (.01) more cautious when it fails too?

                        //also update the wallet

                    }
                    document.getElementById("wallet")
                        .innerHTML = "$" + cash;
                }
                if (action == "research") {

                    if (roll > people[p]['caution']) {
                        happen("Researched " + people[p]['face'] + ": 💰$" + people[p]['wallet'] + ", 💼$" + people[p]['salary'] + ", 🔎:" + Math.floor(people[p]['caution'] * 100) + ", 📅: " + people[p]['routine']);
                    }
                    else {
                        happen(people[p]['face'] + " is careful of their privacy online!");
                    }


                }
            })
        }

        // phishing tool
        document.getElementById('phish').addEventListener('click', function () {
            console.log("you clicked the phisher");
            document.getElementById("current-tool")
                .innerHTML = "Phishing...";
            action = "phish"
        })

        //researching tool
        document.getElementById('research').addEventListener('click', function () {
            console.log("you clicked the researcher");
            document.getElementById("current-tool")
                .innerHTML = "Researching...";
            action = "research"

        })



        //timer and all that happens on it
        setInterval(function () {
            now += 1;
            if (now > 3) {
                now = 0;
                days += 1;
                for (p in people) {
                    if (people[p]['caution'] > 1) {
                        people[p]['caution'] = .99;
                    }
                    //payday once per day
                    people[p]['wallet'] += people[p]['salary']
                    //also drop their suspicion a bit, function of where they're located
                    people[p]['caution'] -= 0.05 * people[p]['caution']
                    //rotate passwords
                    if (people[p]['caution'] > 0.85) {
                        console.log("should lose an account");
                        loseAccount(p);
                        happen(people[p]['face'] + "changed their passwords")

                    }
                }
            }
            time = schedule[now];
            document.getElementById("clock")
                .innerHTML = "day " + days + " " + time;
            document.getElementById("wallet")
                .innerHTML = "$" + cash;
            //this is where UL goes, wipe accounts from list
            for (p in people) {
                //console.log(people[p]);
                move(people[p], people[p]['routine'][now]);

            }
            updateAccounts()

            //todo: here, go thru all businesses and if their suspicion is too high they hold a security training
            // if their suspicion is low maybe they get some money from taking out a loan or something
            //if their suspicion is high maybe they spend some money on security
            // if they hold a security training, the business supsicion goes down, the individual suspicions go up, and people maybe replace the business in their routine
        }, 6000);


    </script>

</body>